{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "messageboard/base.html" %}

{% load i18n %}
{% load account %}

{% block messageboard_subtitle %}{{ object.message.subject }}{% endblock %}

{% block messageboard_header %}{% endblock %}

{% block messageboard_actions %}
{% include "includes/breadcrumbs.html" %}

{% with message=object.message %}
<div class="actions">
  <a href="{% url 'messageboard:message_create_reply' message.id %}">
    {% trans "Reply" %}
  </a>
  <a href="{% url 'messageboard:message_recipient_delete' object.id %}"
     data-controller="ajax confirm"
     data-action="confirm#check ajax#delete"
     data-confirm-header="{% trans 'Delete' %}"
     data-confirm-body="{% trans 'Are you sure you want to delete this message?' %}"
     >
     {% trans "Delete" %}
  </a>
</div>
{% endwith %}
{% endblock messageboard_actions %}

{% block messageboard_content %}
{% with message=object.message %}

<dl>
  <dt>{% trans "Subject" %}</dt>
  <dd>{{ message.subject }}</dd>
  {% with parent=message.parent %}
  {% if parent.sender == user %}
  <dt>{% trans "Reply to" %}</dt>
  <dd><a href="{{ parent.get_absolute_url }}">{{ parent.subject }}</a></dd>
  {% endif %}
  {% endwith %}
  <dt>{% trans "From" %}</dt>
  <dd>
  {% include "users/includes/chip.html" with profile=message.sender %}
  <a href="{% url 'messageboard:sender_message_recipient_list' message.sender.username %}">{% trans "See all from this user" %}</a>
  </dd>
  <dt>{% trans "Received" %}</dt>
  <dd>
  <div class="timesince">
    {% blocktrans with created=message.created|timesince %}
    {{ created }} ago
    {% endblocktrans %}
  </div>
  </dd>
</dl>
{% if message.message %}
<div class="divider"></div>
<div class="markdown-content">
  {{ message.message.markdown }}
</div>
{% endif %}
{% if replies %}

<div class="divider"></div>
<h6>{% trans "My Replies" %}</h6>

<div class="tile">
  {% for reply in replies %}
  <div class="tile-content">
    <div class="tile-title">
      <a href="{{ reply.get_absolute_url }}">{{ reply.subject }}</a>
    </div>
    <div class="tile-subtitle">
      <span class="timesince">
        {{ reply.created|date:"DATETIME_FORMAT" }}
      </span>
    </div>
  </div>
</div>
{% endfor %}
</div>
{% endif %}

{% endwith %}
{% endblock messageboard_content %}

