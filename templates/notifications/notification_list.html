{# Copyright (c) 2020 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "notifications/base.html" %}
{% load i18n %}
{% load notifications %}
{% load users %}

{% block subtitle %} / {% trans "Notifications" %}{% endblock %}

{% block content %}

{% dismissable user "notifications-emails" %}
{% url 'user_update' as user_settings_url %}
{% blocktrans %}
You can enable emails for your notifications
<a href="{{ user_settings_url }}">in your settings</a>.{% endblocktrans %}
{% enddismissable %}


<h1 class="page-header mb-2">{% trans "Notifications" %}</h1>

{% if object_list %}
<div class="flex flex-wrap items-center text-sm mb-4">
  {% if is_unread_notifications %}
  <a class="inline-block mr-4"
     href="{% url 'notifications:mark_all_read' %}"
     data-turbolinks="false"
     data-controller="ajax"
     data-action="ajax#post">{% trans "Mark All Read" %}</a>
  {% endif %}
  <a class="inline-block"
     href="{% url 'notifications:delete_all' %}"
     data-turbolinks="false"
     data-controller="ajax"
     data-action="ajax#post"
     data-ajax-confirm-header="{% trans 'Delete All' %}"
     data-ajax-confirm-body="{% trans 'Are you sure you want to delete all your notifications?' %}">{% trans "Delete All" %}</a>
</div>
{% endif %}

{% notifications_subscribe_btn user community %}

{% if object_list %}

<table class="table-auto text-sm block whitespace-no-wrap overflow-x-scroll md:w-full md:whitespace-normal md:overflox-x-auto md:table">
  <tbody>
    {% for notification in object_list %}
    {% notification notification %}
    <tr class="{% cycle 'bg-gray-100' '' %} hover:bg-gray-200">
      <td class="border py-2 px-2{% if not notification.is_read %} text-bold{% endif %}">

        {{ notification_content }}
        {% if not notification.is_read %}
        <div class="tag tag-primary">{% trans "New" %}</div>
        {% endif %}
        </div>
        </div>
      </td>
      <td class="border py-2 px-2 text-right text-gray-600">
        {% blocktrans with created=notification.created|timesince %}
        {{ created }} ago
        {% endblocktrans %}
      </td>
      <td class="border py-2 px-2">
        <div class="text-right">
          {% if not notification.is_read %}
          <a class="inline-block mr-4"
             href="{% url 'notifications:mark_read' notification.pk %}"
             data-turbolinks="false"
             data-controller="ajax"
             data-action="ajax#post">{% trans "Mark Read" %}</a>
          {% endif %}
          <a class="inline-block"
             href="{% url 'notifications:delete' notification.pk %}"
             data-turbolinks="false"
             data-controller="ajax"
             data-action="ajax#post">{% trans "Delete" %}</a>
        </div>
      </td>
    </tr>
    {% endnotification %}
    {% endfor %}
  </tbody>
</table>
{% include "includes/pagination.html" %}
{% else %}
{% include "includes/empty.html" %}
{% endif %}
{% endblock %}
