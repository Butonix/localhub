{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "base.html" %}
{% load i18n %}
{% load rules %}

{% block content %}

<h3>{% trans "People" %}</h3>
<div class="divider"></div>


<ul class="tab tab-block mt-1">
  <li class="tab-item" data-controller="active-link" data-active-link-exact>
    <a data-target="active-link.match"
       href="{% url 'users:following_list' %}">{% trans "Following" %}</a>
  </li>
  <li class="tab-item" data-controller="active-link" data-active-link-exact>
    <a data-target="active-link.match"
       href="{% url 'users:follower_list' %}">{% trans "Followers" %}</a>
  </li>
  <li class="tab-item" data-controller="active-link" data-active-link-exact>
    <a data-target="active-link.match"
       href="{% url 'users:blocked_list' %}">{% trans "Blocked" %}</a>
  </li>
</ul>



{% test_rule "communities.is_member" user community as is_member %}
{% has_perm "messageboard.create_message" user community as can_create_message %}

{% if object_list %}

<div class="my-1 toast text-center">
  {% block counter %}
  {% endblock counter %}
</div>

<table class="table table-striped table-hover">
  <tbody>
    {% for user_obj in object_list %}
    <tr>
      <td>
        {% include "users/includes/chip.html" with profile=user_obj %}
      </td>
      {% if is_member %}
      <td>
        {% if user != user_obj %}
        <div class="actions actions-sm float-right" data-controller="toggle">
          {% has_perm "users.follow_user" user user_obj as can_follow_user %}
          {% if can_follow_user %}
          <a href="{% url 'users:unfollow' user_obj.username %}"
             {% if not user_obj.is_following %}class="d-hide"{% endif %}
             data-controller="ajax"
             data-ajax-redirect="none"
             data-target="toggle.togglable"
             data-toggle-target="follow"
             data-action="ajax#post toggle#toggle">
            {% trans "Unfollow" %}
          </a>
          <a href="{% url 'users:follow' user_obj.username %}"
             {% if user_obj.is_following %}class="d-hide"{% endif %}
             data-controller="ajax"
             data-ajax-redirect="none"
             data-target="toggle.togglable"
             data-toggle-target="follow"
             data-action="ajax#post toggle#toggle">
            {% trans "Follow" %}
          </a>
          {% endif %}
          {% if can_create_message %}
          <a href="{% url 'messageboard:message_create_pm' user_obj.username %}">
            {% trans "Send Message" %}
          </a>
          {% endif %}
        </div>
        {% endif %}
      </td>
      {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>
{% include "includes/pagination.html" %}
{% else %}
{% include "includes/empty.html" %}
{% endif %}
{% endblock content %}
