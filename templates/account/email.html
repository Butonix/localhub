{% extends "users/base.html" %}

{% load i18n %}
{% load widget_tweaks %}

{% block title %}{% trans "Email Addresses" %}{% endblock %}

{% block users_content %}
<h3>{% trans "Email Addresses" %}</h3>
{% with emailaddresses=user.emailaddress_set.all emailaddress_count=user.emailaddress_set.count %}
{% if emailaddress_count %}
<p>{% trans 'The following e-mail addresses are associated with your account:' %}</p>

<form action="{% url 'account_email' %}" method="post">
  {% csrf_token %}

  {% for emailaddress in emailaddresses %}
  <div class="form-group">
    <label for="email_radio_{{ forloop.counter }}" class="form-label">
      <input id="email_radio_{{ forloop.counter }}" type="radio" name="email" {% if emailaddress.primary or emiladdress_count == 1 %}checked="checked"{% endif %} value="{{ emailaddress.email }}"/>
      {{ emailaddress.email }}
      {% if emailaddress.verified %}
      <span class="chip">{% trans "Verified" %}</span>
      {% else %}
      <span class="chip">{% trans "Unverified" %}</span>
      {% endif %}
      {% if emailaddress.primary %}<span class="chip">{% trans "Primary" %}</span>{% endif %}
    </label>
  </div>
  {% endfor %}

  <div class="btn-group">
    <button class="btn btn-secondary" type="submit" name="action_primary">{% trans 'Make Primary' %}</button>
    <button class="btn btn-secondary" type="submit" name="action_send">{% trans 'Re-send Verification' %}</button>
    <button class="btn btn-primary" data-js-open-modal="confirm-remove-email-modal">{% trans 'Remove' %}</button>
  </div>

  <div class="modal" id="confirm-remove-email-modal">
    <a href="#" class="modal-overlay" aria-label="Close" data-js-close-modal></a>
    <div class="modal-container">
      <div class="modal-header">
        <a href="#" class="btn btn-clear float-right" aria-label="Close" data-js-close-modal></a>
        <div class="modal-title h5">Confirmation</div>
      </div>
      <div class="modal-body">
        <div class="content">
          {% trans 'Do you really want to remove the selected e-mail address?' %}
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-link" data-js-close-modal>Cancel</button>
        <button class="btn btn-primary" type="submit" name="action_remove">Remove</button>
      </div>
    </div>
  </div>

</form>

{% else %}
<p><strong>{% trans 'Warning:'%}</strong> {% trans "You currently do not have any e-mail address set up. You should really add an e-mail address so you can receive notifications, reset your password, etc." %}</p>

{% endif %}

{% endwith %}

<div class="divider"></div>

<h3>{% trans "Add E-mail Address" %}</h3>

<div class="columns">
  <div class="column col-6 col-sm-12">
    <form method="post" action="{% url 'account_email' %}" class="add_email">
      {% csrf_token %}
      <div class="form-group {% if form.email.errors %} has-error{% endif %}">
        <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
        {% render_field form.email class="form-input" placeholder=form.email.label %}
        {% for error in form.email.errors %}
        <p class="form-input-hint">{{ error }}</p>
        {% endfor %}
      </div>
      <button name="action_add" class="btn btn-primary" type="submit">{% trans "Add E-mail" %}</button>
    </form>
  </div>
</div>
{% endblock users_content %}
