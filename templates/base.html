{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% load static %}
{% load i18n %}
{% load rules %}
<!DOCTYPE html>
<html lang="en">

  <head>
    <title>
      {% block title %}
      {% if request.community %}{{ request.community.name }}{% else %}{{ request.site.name }}{% endif %}
      {% endblock %}
    </title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="turbolinks-cache-control" content="no-cache">
    <link rel="stylesheet" href="{% static 'dist/main.css' %}">
    <script defer src="{% static 'dist/main.js' %}"></script>
  </head>

  <body>
    <div class="container">
    <header class="navbar bg-dark px-2 py-1 my-2">
      <section class="navbar-section">
        <a class="navbar-brand mr-2 text-light" href="/">
          {% if request.community %}{{ request.community.name }}{% else %}communikit{% endif %}
        </a>
      </section>
      {% if request.community %}
      {% has_perm "communities.view_community" user request.community as can_view_community %}
      {% if can_view_community %}
      <section class="navbar-section hide-sm">
        <form method="GET"
              action="{% url 'activities:search' %}"
              data-controller="form"
              data-action="form#submit"
              >
              <div class="input-group input-inline">
                <input class="form-input" name="q" type="search" placeholder="{% trans "Search" %}">
                <button class="btn bg-gray text-dark input-group-btn">{% trans "Search" %}</button>
              </div>
        </form>
      </section>
      {% endif %}
      {% endif %}
      <section class="navbar-section">
        {% with current_url=request.resolver_match.url_name %}
        {% if user.is_authenticated %}
        <a class="btn btn-link text-light" href="{% url 'users:update' %}">{{ user.username }}</a>
        {% else %}
        <a class="btn btn-link{% if current_url == 'account_login' %} active{% endif %} text-light" href="{% url 'account_login' %}">{% trans "login" %}</a>
        <a class="btn btn-link{% if current_url == 'account_signup' %} active{% endif %} text-light" href="{% url 'account_signup' %}">{% trans "signup" %}</a>
        {% endif %}
        {% endwith %}
      </section>
    </header>
    {% if request.community %}
    {% has_perm "communities.view_community" user request.community as can_view_community %}
    {% if can_view_community %}
    <form method="GET"
          action="{% url 'activities:search' %}"
          class="form-horizontal show-sm mb-2"
          data-controller="form"
          data-action="form#submit"
          >
          <div class="input-group">
            <input class="form-input" name="q" type="search" placeholder="{% trans "Search" %}">
            <button class="btn btn-primary input-group-btn">{% trans "Search" %}</button>
          </div>
    </form>
    {% endif %}
    {% endif %}
    <div class="text-center mb-2 toast toast-primary d-hide" data-controller="cookie-notice" data-cookie-notice-domain="{{ community.domain }}">
      <button class="btn btn-clear float-right" data-action="cookie-notice#accept"></button>
      {% blocktrans %}
      This site uses cookies for authentication purposes only. We do not share your personal
      information with third parties.
      {% endblocktrans %}
    </div>
    {% for message in messages %}
    <div class="text-center mb-2 toast toast-{{ message.tags }}" data-controller="alert">
      <button class="btn btn-clear float-right" data-action="alert#dismiss"></button>
      {{ message }}
    </div>
    {% endfor %}

    {% block content %}
    {% endblock content %}
    </div>
    <footer class="text-center p-2 text-gray">
      &copy; Dan Jacob {% now "Y" %}. <a href="https://gitlab.com/danjac/communikit/">Open software</a> licensed under <a href="http://www.affero.org/oagpl.html">AGPL</a>.
    </footer>
    {% include "includes/confirm_dialog.html" %}
  </body>

</html>
