{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% load i18n %}
{% load rules %}
{% load thumbnail %}

{% has_perm "activities.change_activity" user photo as can_change_photo %}
{% has_perm "activities.delete_activity" user photo as can_delete_photo %}
{% has_perm "activities.like_activity" user photo as can_like_photo %}

<div class="card content-card">
    <div class="card-header">
        <div class="card-subtitle text-gray float-right">
            {% blocktrans with photo.created|timesince as created %}{{ created }} ago{% endblocktrans %}
        </div>
        <div class="card-title h6"><a href="{{ photo.get_absolute_url }}">{{ photo.title }}</a></div>
        <div class="card-subtitle h6"><a href="{{ photo.owner.get_absolute_url }}">{{ photo.owner.username }}</a></div>
        {% if photo.tags %}
        <div class="card-title h6">{{ photo.linkify_tags }}</div>
        {% endif %}
    </div>
    <div class="card-body">
        {% thumbnail photo.image "600" crop="center" as image %}
        <img src="{{ image.url }}" width="{{ image.width }}" height="{{ image.height }}" alt="{{ photo.title }}">
        {% empty %}
        <em>No photo available</em>
        {% endthumbnail %}
    </div>
    <div class="card-footer">

        <div class="d-flex content-actions">

            <div class="mr-2">
                <a href="{{ photo.image.url }}" download>{% trans "Download" %}</a>
            </div>

            {% if photo.owner_id == user.id %}
            <div class="mr-2">{% trans "Likes" %} ({{ photo.num_likes }})</div>
            {% elif can_like_post %}
            <div class="mr-2">
                <a href="#"
                   data-controller="ajax"
                   data-action="ajax#post"
                   {% if photo.has_liked %}
                   data-ajax-url="{% url 'posts:dislike' photo.id %}"
                   {% else %}
                   data-ajax-url="{% url 'posts:like' photo.id %}"
                   {% endif %}
                   data-ajax-redirect="{{ request.get_full_path }}"
                   >
                   {% if photo.has_liked %}{% trans "Unlike" %}{% else %}{% trans "Like" %}{% endif %}
                </a>
            </div>
            {% endif %}

            <div class="mr-2">
                <a href="{{ photo.get_absolute_url }}#comments">
                    {% trans "Comments" %} {% if photo.num_comments %}({{ photo.num_comments }}){% endif %}
                </a>
            </div>

            <!--
                <div class="mr-2">
                <a href="">{% trans "Flag" %}</a>
                </div>
            -->

            {% if can_change_photo %}
            <div class="mr-2">
                <a href="{% url 'photos:update' photo.id %}"
                   >{% trans "Update" %}</a>
            </div>
            {% endif %}

            {% if can_delete_photo %}
            <div class="mr-2">
                {% url 'photos:delete' photo.id as delete_url %}
                <a href="{{ delete_url }}"
                   data-controller="ajax confirm"
                   data-action="confirm#check ajax#delete"
                   data-ajax-url="{{ delete_url }}"
                   data-ajax-redirect="{{ request.get_full_path }}"
                   data-confirm-header="{% trans 'Delete Photo' %}"
                   data-confirm-body="{% trans 'Are you sure you want to delete this photo?' %}"
                   >{% trans "Delete" %}</a>
            </div>
            {% endif %}

            <div class="">
                <a href="{{ photo.get_permalink }}">{% trans "Permalink" %}</a>
            </div>
        </div>
    </div>

</div>

