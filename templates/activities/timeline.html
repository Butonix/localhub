{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "base.html" %}
{% load i18n %}

{% block subtitle %} | {% trans "Timeline" %}{% endblock %}

{% block content %}
<h3>{% trans "Timeline" %}</h3>
<div class="actions">
    <a href="{% url 'activities:home_page' %}">{% trans "Stream" %}</a>
    {% if view.sort_by_ascending %}
    <a href="{{ request.path }}?order=desc">{% trans "Newest First" %}</a>
    {% else %}
    <a href="{{ request.path }}?order=asc">{% trans "Oldest First" %}</a>
    {% endif %}
    {% if date_filters %}
    <a href="{{ request.path }}">{% trans "Show All" %}</a>
    {% endif %}
</div>

{% if years|length > 1 %}
<div class="actions mt-2">
    {% for year in years %}
    <a href="{{ request.path }}?year={{ year }}">{{ year }}</a>
    {% endfor %}
</div>
{% endif %}

{% if months|length > 1 %}
<div class="actions mt-2">
    {% for order, name in months %}
    <a href="{{ request.path }}?month={{ order }}&year={{ current_year }}">{{ name }}</a>
    {% endfor %}
</div>
{% endif %}
<div class="divider"></div>

{% if dates %}
{% spaceless %}
<div class="my-2 toast text-center">
    {% blocktrans count counter=paginator.count %}
    A total of <strong>1 post</strong> was published
    {% plural %}
    A total of <strong>{{ counter }} posts</strong> were published
    {% endblocktrans %}

    {% with num_months=months|length num_years=years|length %}

    {% if num_months == 1 and num_years == 1 %}
    {% with earliest=dates|first|date:"E Y" %}
    {% blocktrans %}
    in {{ earliest }}.
    {% endblocktrans %}
    {% endwith %}

    {% elif num_years == 1 %}
    {% with earliest=dates|first|date:"E" latest=dates|last|date:"E Y" %}
    {% blocktrans %}
    from {{ earliest }} to {{ latest }}.
    {% endblocktrans %}
    {% endwith %}

    {% else %}
    {% with earliest=dates|first|date:"E Y" latest=dates|last|date:"E Y" %}
    {% blocktrans %}
    from {{ earliest }} to {{ latest }}.
    {% endblocktrans %}
    {% endwith %}
    {% endif %}

    {% endwith %}
</div>
{% endspaceless %}
{% endif %}

{% if object_list %}

<div class="timeline">
    {% regroup object_list by month as months %}
    {% for month, activities in months %}
    <div class="timeline-item">
        <div class="timeline-left"><a class="timeline-icon tooltip"
               href="#"
               data-tooltip="{{ month }}"></a></div>

        <div class="timeline-content">
            <div class="tile">
                <div class="tile-content">
                    <p class="tile-subtitle">{{ month }}</p>
                    {% for activity in activities %}
                    <p class="tile-title">
                        <a href="{{ activity.object.get_absolute_url }}">
                            {{ activity.object|truncatechars:100 }}
                        </a>
                        <span class="chip">{% trans activity.object_type|capfirst %}</span>
                    </p>
                    <p class="tile-title">
                        <div>
                            <span class="timesince">
                                {% blocktrans with since=activity.object.published|timesince %}
                                {{ since }} ago
                                {% endblocktrans %}
                                {% include "users/includes/chip.html" with profile=activity.object.owner %}
                            </span>
                        </div>
                    </p>
                    <div class="divider"></div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% include "includes/pagination.html" %}
{% else %}
{% trans "There are no posts for this period" as t_empty %}
{% include "includes/empty.html" with empty_message=t_empty %}
{% endif %}
{% endblock content %}