{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "base.html" %}
{% load i18n %}

{% block subtitle %} | {% trans "Timeline" %}{% endblock %}

{% block content %}
<h5>{% trans "Timeline" %}</h5>

{% with num_years=years|length num_months=months|length %}
{% if date_filters or num_years > 1 or num_months > 1 %}
<div class="actions">
    <a href="{{ reverse_sort_url }}">
      {% if order == "desc" %}{% trans "Ascending" %}{% else %}{% trans "Descending" %}{% endif %}
    </a> |
    {% if date_filters %}
    <a href="{{ request.path }}?order={{ order }}">{% trans "All" %}</a>
    {% endif %}
    {% if num_years > 1 %}
    {% for year in years %}
    <a href="{{ request.path }}?year={{ year }}&order={{ order }}">{{ year }}</a>
    {% endfor %}
    {% endif %}
    {% if num_months > 1 %}
    {% for counter, name in months %}
    <a href="{{ request.path }}?month={{ counter }}&year={{ current_year }}&order={{ order }}">{{ name }}</a>
    {% endfor %}
    {% endif %}
</div>
{% endif %}
{% endwith %}

{% if dates %}
{% spaceless %}
<div class="my-2 toast text-center">
    {% blocktrans count counter=paginator.count %}
    <strong>One activity</strong> was posted
    {% plural %}
    A total of <strong>{{ counter }} activities</strong> were posted
    {% endblocktrans %}
    {% with num_months=months|length num_years=years|length %}
    {% if num_months == 1 and num_years == 1 %}
    {% with earliest=dates|first|date:"E Y" %}
    {% blocktrans %}
    in {{ earliest }}.
    {% endblocktrans %}
    {% endwith %}

    {% elif num_years == 1 %}
    {% with earliest=dates|first|date:"E" latest=dates|last|date:"E Y" %}
    {% blocktrans %}
    from {{ earliest }} to {{ latest }}.
    {% endblocktrans %}
    {% endwith %}

    {% else %}
    {% with earliest=dates|first|date:"E Y" latest=dates|last|date:"E Y" %}
    {% blocktrans %}
    from {{ earliest }} to {{ latest }}.
    {% endblocktrans %}
    {% endwith %}
    {% endif %}

    {% endwith %}
</div>
{% endspaceless %}
{% endif %}

{% if object_list %}

<div class="timeline">
    {% regroup object_list by month as months %}
    {% for month, activities in months %}
    <div class="timeline-item">
        <div class="timeline-left"><a class="timeline-icon tooltip"
               href="#"
               data-tooltip="{{ month }}"></a></div>

        <div class="timeline-content">
            <div class="tile">
                <div class="tile-content">
                    <p class="tile-subtitle">{{ month }}</p>
                    {% for activity in activities %}
                    {% with object=activity.object object_type=activity.object_type %}
                    <p class="tile-title">
                        <a href="{{ object.get_absolute_url }}">
                            {{ object|truncatechars:100 }}
                        </a>
                        <span class="chip">{% trans object_type|capfirst %}</span>
                    </p>
                    <p class="tile-title">
                        {% include "activities/includes/timesince.html" with timestamp=object.published owner=object.owner %}
                    </p>
                    <div class="divider"></div>
                    {% endwith %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% include "includes/pagination.html" %}
{% else %}
{% trans "There are no items for this period" as t_empty %}
{% include "includes/empty.html" with empty_message=t_empty %}
{% endif %}
{% endblock content %}
