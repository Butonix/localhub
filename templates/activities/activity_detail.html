{# Copyright (c) 2020 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "activities/base.html" %}

{% load i18n %}
{% load activities %}
{% load comments %}

{% block subtitle %} / {{ object|verbose_name_plural|title }} / {{ object.title }}{% endblock %}

{% block content %}

{% block breadcrumbs %}
<ul class="breadcrumbs mb-3">
  {% if object.published %}
  <li class="breadcrumb-item">
    <a href="{{ object|resolve_url:"list" }}">
      {{ object|verbose_name_plural|title }}
    </a>
  </li>
  {% else %}
  <li class="breadcrumb-item">
    <a href="{% url 'activities:private' %}">{% trans "Private Stash" %}</a>
  </li>
  {% endif %}
  <li class="breadcrumb-item">
    {{ object.title|truncatechars:60 }}
  </li>
</ul>
{% endblock breadcrumbs %}

{% if comments.number == 1 %}
{% if object.deleted %}
<p class="toast text-center my-2">
  {% blocktrans %}
  This {{ object_name }} has been removed by a community moderator.
  {% endblocktrans %}
</p>
{% endif %}

{% block activities_detail_content %}
{% render_activity request user object is_detail=True reshares=reshares %}
{% endblock %}
{% include "flags/includes/flags.html" %}
{% endif %}

{% if object.published %}
<div class="comments mt-2"
     id="comments">
  {% if comments.paginator.count %}
  {% if comments.number == 1  %}
  <div class="divider text-center"
       data-content="{% trans "Comments" %}"></div>
  {% else %}
  {% include "includes/pagination.html" with css_class="mb-2" page_obj=comments is_paginated=True %}
  {% endif %}
  {% endif %}

  {% for comment in comments %}
  {% render_comment request user comment include_content_object=False css_class="mb-2" %}
  {% endfor %}

  {% if comments.number == 1 and comments.paginator.num_pages > 1 %}
  {% include "includes/pagination.html" with css_class="my-2" page_obj=comments is_paginated=True %}
  {% endif %}

  {% if comment_form %}
  {% include "includes/forms/stimulusjs_form.html" with action=object|resolve_url:"comment" form=comment_form form_id="comment-form" css_class="px-2 py-5 border border-gray-500 w-full" %}
  {% elif not object.allow_comments %}
  <p class="toast text-center my-2">{% trans "Comments are locked" %}</p>
  {% elif object.published %}
  <p class="toast text-center my-2">
    {% trans "You do not have permission to post comments on this site." %}
  </p>
  {% endif %}

</div>
{% endif %}
{% endblock content %}
