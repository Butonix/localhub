{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% load i18n %}
{% load rules %}

<div class="actions">

   {% has_perm "activities.pin_activity" user object as can_pin %}

   {% if can_pin %}
   {% if object.is_pinned %}
   <a href="{{ object.get_unpin_url }}"
      class="d-hide"
      data-controller="ajax js-toggle"
      data-action="ajax#post"><s>{% trans "Pin" %}</s></a>
   {% else %}
   <a href="{{ object.get_pin_url }}"
      class="d-hide"
      data-controller="ajax js-toggle"
      data-action="ajax#post">{% trans "Pin" %}</a>
   {% endif %}
   {% endif %}

   {% if not is_detail %}

   {% has_perm "activities.create_comment" user object as can_create_comment %}
   {% if can_create_comment %}
   <a href="{{ object.get_absolute_url }}#comment-form">
      {% trans "Comment" %}
   </a>
   {% endif %}
   {% endif %}

   {% if user.is_authenticated %}
   {% block actions %}

   {% has_perm "activities.like_activity" user object as can_like %}
   {% if can_like %}
   <span class="d-hide"
         data-controller="toggle js-toggle">
      <a href="{{ object.get_like_url }}"
         {% if object.has_liked %}
         class="d-hide"
         {% endif %}
         data-controller="ajax"
         data-target="toggle.togglable"
         data-toggle-target="like"
         data-ajax-redirect="none"
         data-action="ajax#post toggle#toggle">{% trans "Like" %}</a>
      <a href="{{ object.get_dislike_url }}"
         {% if not object.has_liked %}
         class="d-hide"
         {% endif %}
         data-controller="ajax"
         data-target="toggle.togglable"
         data-toggle-target="like"
         data-ajax-redirect="none"
         data-action="ajax#post toggle#toggle"><s>{% trans "Like" %}</s></a>
   </span>
   {% endif %}

   {% if not object.has_reshared %}
   {% has_perm "activities.reshare_activity" user object as can_reshare %}
   {% if can_reshare %}
   <a class="d-hide"
      data-controller="js-toggle ajax"
      data-action="ajax#post"
      data-ajax-redirect="{{ request.path }}"
      href="{{ object.get_reshare_url }}">{% trans "Reshare" %}</a>
   {% endif %}
   {% endif %}

   {% has_perm "activities.flag_activity" user object as can_flag %}
   {% if can_flag and not object.has_flagged %}
   <a href="{{ object.get_flag_url }}">
      {% trans "Flag" %}
   </a>
   {% endif %}

   {% has_perm "activities.change_activity" user object as can_change %}
   {% if can_change %}

   {% if not object.published %}
   <a class="d-hide"
      data-controller="js-toggle ajax confirm"
      data-action="confirm#check ajax#post"
      data-confirm-header="{% trans 'Publish' %}"
      data-confirm-body="{% trans 'Are you sure you want to publish this draft?' %}"
      href="{{ object.get_publish_url }}">{% trans "Publish" %}</a>
   {% endif %}
   <a href="{{ object.get_update_url }}">{% trans "Edit" %}</a>
   {% endif %}


   {% has_perm "activities.delete_activity" user object as can_delete %}
   {% if can_delete %}
   <a href="{{ object.get_delete_url }}"
      data-controller="ajax confirm"
      data-action="confirm#check ajax#post"
      data-confirm-header="{% trans 'Delete' %}"
      data-confirm-body="{% trans 'Are you sure you want to delete this activity? All comments will also be deleted.' %}">{% trans "Delete" %}</a>
   {% endif %}

   {% endblock %}
   {% endif %}

   <a href="{{ object.get_permalink }}">{% trans "Link" %}</a>
   {% block extra_actions %}{% endblock %}

</div>