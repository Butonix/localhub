{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% load i18n %}
{% load activities_tags %}
{% load rules %}

<div class="{{ css_class }}">
    <div class="dropdown">
        <a class="btn dropdown-toggle"
           tabindex="0">
            {% trans "Actions" %}
            <i class="icon icon-caret"></i>
        </a>
        <ul class="menu"
            data-controller="toggle">

            {% if not is_detail %}

            {% has_perm "activities.create_comment" user object as can_create_comment %}
            {% if can_create_comment %}
            <li class="menu-item">
                <a href="{{ object.get_absolute_url }}#comment-form">
                    {% trans "Comment" %}
                </a>
            </li>
            {% endif %}
            {% endif %}

            {% if user.is_authenticated %}
            {% block actions %}

            {% has_perm "activities.pin_activity" user object as can_pin %}

            {% if can_pin %}
            <li class="menu-item d-hide"
                data-controller="js-toggle">
                <a href="{{ object.get_pin_url }}"
                   {% if object.is_pinned %}
                   class="d-hide"
                   {% endif %}
                   data-controller="ajax"
                   data-action="ajax#post">{% trans "Pin" %}</a>
                <a href="{{ object.get_unpin_url }}"
                   {% if not object.is_pinned %}
                   class="d-hide"
                   {% endif %}
                   data-controller="ajax"
                   data-action="ajax#post">{% trans "Unpin" %}</a>
            </li>
            {% endif %}

            {% has_perm "activities.like_activity" user object as can_like %}
            {% if can_like %}
            <li class="menu-item d-hide"
                data-controller="js-toggle">
                <a href="{{ object.get_like_url }}"
                   {% if object.has_liked %}
                   class="d-hide"
                   {% endif %}
                   data-controller="ajax"
                   data-target="toggle.togglable"
                   data-toggle-target="like"
                   data-ajax-redirect="none"
                   data-action="ajax#post toggle#toggle">{% trans "Like" %}</a>
                <a href="{{ object.get_dislike_url }}"
                   {% if not object.has_liked %}
                   class="d-hide"
                   {% endif %}
                   data-controller="ajax"
                   data-target="toggle.togglable"
                   data-toggle-target="like"
                   data-ajax-redirect="none"
                   data-action="ajax#post toggle#toggle">{% trans "Unlike" %}</a>
            </li>
            {% endif %}

            {% if not object.has_reshared %}
            {% has_perm "activities.reshare_activity" user object as can_reshare %}
            {% if can_reshare %}
            <li class="menu-item">
                <a class="d-hide"
                   data-controller="js-toggle ajax"
                   data-action="ajax#post"
                   data-ajax-redirect="{{ request.path }}"
                   href="{{ object.get_reshare_url }}">{% trans "Reshare" %}</a>
            </li>
            {% endif %}
            {% endif %}

            {% has_perm "activities.flag_activity" user object as can_flag %}
            {% if can_flag and not object.has_flagged %}
            <li class="menu-item">
                <a href="{{ object.get_flag_url }}">
                    {% trans "Flag" %}
                </a>
            </li>
            {% endif %}

            {% has_perm "activities.change_activity" user object as can_change %}
            {% if can_change %}
            <li class="menu-item">
                <a href="{{ object.get_update_url }}">{% trans "Edit" %}</a>
            </li>
            {% endif %}


            {% has_perm "activities.delete_activity" user object as can_delete %}
            {% if can_delete %}
            <li class="menu-item">
                <a href="{{ object.get_delete_url }}"
                   data-controller="ajax confirm"
                   data-action="confirm#check ajax#post"
                   data-confirm-header="{% trans 'Delete' %}"
                   data-confirm-body="{% trans 'Are you sure you want to delete this activity? All comments will also be deleted.' %}">{% trans "Delete" %}</a>
            </li>
            {% endif %}

            {% endblock %}
            {% endif %}

            <li class="menu-item">
                <a href="{{ object.get_permalink }}">{% trans "Permalink" %}</a>
            </li>

        </ul>
    </div>
</div>