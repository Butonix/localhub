{# Copyright (c) 2020 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "activities/base.html" %}

{% load i18n %}
{% load rules %}
{% load activities %}
{% load notifications %}
{% load users %}

{% block subtitle %} / {% trans "Activities" %} {% endblock %}

{% block content %}

{% if page_obj.number == 1 %}

{% if notifications %}
<div data-controller="notifications">
  {% for item in notifications %}
  {% notification item %}
  <div class="notification flex mb-3{% if not forloop.first %} hidden{% endif %}"
       data-target="notifications.notification">
    <div class="mx-auto text-center">
      {{ notification_content }}
    </div>

    <button data-action="notifications#dismiss"
            data-notifications-mark-read-url="{% url 'notifications:mark_read' item.id %}">
      <i class="fa fa-times-circle"></i>
    </button>
  </div>
  {% endnotification %}
  {% endfor %}
</div>
{% endif %}

{% get_pinned_activity user community as pinned %}
{% if pinned %}
{% render_activity request user pinned.object is_pinned=True css_class="mb-3" %}
{% endif %}

{% test_rule "communities.is_member" user community as is_member %}

{% if not is_member %}
{% has_perm "join_requests.create" user community as can_create_join_request %}
{% if can_create_join_request %}
{% url 'join_requests:create' as request_invite_url %}
<p class="font-semibold mb-3">
  {% blocktrans %}
  You are not a member of this community, so you cannot post content or send private messages. Click <a href="{{ request_invite_url }}">here</a> to request an invite.
  {% endblocktrans %}
</p>
{% endif %}
{% endif %}

{% include "activities/includes/submit_cta.html" with css_class="mb-3" %}

{% endif %}
{% include "activities/includes/activity_list.html" %}
{% endblock content %}
