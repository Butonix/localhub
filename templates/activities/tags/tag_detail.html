{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "activities/base.html" %}
{% load i18n %}
{% load rules %}

{% block subtitle %} #{{ tag.slug }}{% endblock %}
{% block content %}

{% has_perm "users.follow_tag" user as can_follow_tag %}
{% has_perm "users.block_tag" user as can_block_tag %}

{% if can_follow_tag or can_block_tag %}
<div class="float-right">
  {% if can_follow_tag %}
  {% if object in user.following_tags.all %}
  <a href="{% url 'activities:tag_unfollow' tag.slug %}"
     class="btn btn-sm"
     data-controller="ajax"
     data-action="ajax#post">
    {% trans "Unfollow" %}
  </a>
  {% else %}
  <a href="{% url 'activities:tag_follow' tag.slug %}"
     class="btn btn-sm"
     data-controller="ajax"
     data-action="ajax#post">
    {% trans "Follow" %}
  </a>
  {% endif %}
  {% endif %}
  {% if can_block_tag %}
  {% if tag in user.blocked_tags.all %}
  <a href="{% url 'activities:tag_unblock' tag.slug %}"
     class="btn btn-sm"
     data-controller="ajax"
     data-ajax-redirect="{{ request.path }}"
     data-action="ajax#post">
    {% trans "Unblock" %}
  </a>
  {% else %}
  <a href="{% url 'activities:tag_block' tag.slug %}"
     class="btn btn-sm"
     data-controller="ajax"
     data-ajax-redirect="{{ request.path }}"
     data-action="ajax#post">
    {% trans "Block" %}
  </a>
  {% endif %}
  {% endif %}
</div>
<div class="clearfix"></div>
{% endif %}

<h3>#{{ tag.slug }}</h3>
{% with total=paginator.count %}
<h4 class="text-gray">{% blocktrans count counter=total %}{{ total }} result{% plural %}{{ total }} results{% endblocktrans %}</h4>
{% endwith %}

{% for activity in object_list %}
<div class="mt-2">
  {% include "activities/includes/activity.html" %}
</div>
{% empty %}
<div class="empty">
  <p class="empty-title h5">{% trans "Sorry, no results found for this tag" %}</p>
</div>
{% endfor %}

{% include "includes/pagination.html" %}
{% endblock content %}
