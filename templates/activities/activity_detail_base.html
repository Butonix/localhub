{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "activities/base.html" %}

{% load i18n %}

{% block subtitle %}{{ object }}{% endblock %}

{% block content %}
{% include "includes/breadcrumbs.html" %}
{% block activities_detail_content %}{% endblock %}
{% include "flags/includes/flags.html" %}
<div class="comments mt-1" id="comments">
  {% if comments %}
  <div class="divider text-center" data-content="{% trans 'Comments' %}"></div>
  {% endif %}
  {% for comment in comments %}
  <div class="mb-1">
    {% include "comments/includes/comment.html" %}
  </div>
  {% endfor %}
  {% if comment_form %}
  <div class="divider"></div>
  <form method="POST"
        action="{{ object.get_create_comment_url }}"
        data-controller="form"
        data-action="form#submit beforeunload@window->form#unload turbolinks:before-visit@window->form#unload">
        {% include "includes/forms/fields.html" with form=comment_form %}
        <button type="submit" class="btn btn-primary">
          {% trans 'Submit' %}
        </button>
  </form>
  {% elif not object.allow_comments %}
  <p class="toast text-center my-1">{% trans "Comments are locked" %}</p>
  {% elif not user.is_authenticated %}
  <p class="toast text-center my-1">
    {% url 'account_login' as login_url %}
    {% blocktrans with next_url=request.path %}Please <a href="{{ login_url }}?next={{ next_url }}">sign in</a> to post comments.{% endblocktrans %}
  </p>
  {% else %}
  <p class="toast text-center my-1">
    {% trans "You do not have permission to post comments on this site." %}
  </p>
  {% endif %}
</div>
{% endblock content %}
