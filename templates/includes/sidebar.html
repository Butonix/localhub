{% load i18n %}
{% load rules %}
{% load communities %}

{% get_community_count user as communities_count %}
{% test_rule "communities.is_member" user community as is_member %}

<aside class="hidden lg:block text-sm w-full lg:w-1/6"
       data-target="sidebar.nav">
  {% if is_member %}

  {% has_perm "activities.create_activity" user community as can_create_activity %}
  {% has_perm "communities.moderate_community" user community as can_moderate_community %}
  {% has_perm "communities.manage_community" user community as can_manage_community %}
  {% has_perm "private_messages.create_message" user community as can_create_message %}

  <button class="lg:hidden border border-gray-500 bg-gray-100 hover:bg-gray-200 text-sm mb-4 w-full p-1"
          data-action="sidebar#toggle">
    {% trans "Close Menu" %}
  </button>

  <ul class="border border-gray-500 p-3 bg-gray-100">
    <li><a href="{{ home_page_url }}"
         data-controller="active-link"
         data-active-link-exact
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Activities" %}</a></li>
    <li>
      <a href="{% url 'private_messages:inbox' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">
        <span>{% trans "Messages" %}</span>
        {% if site_counters.unread_messages %}
        <span class="inline-flex bg-blue-600 rounded text-white font-bold p-1 px-2 ml-2 justify-center text-xs">{% trans "New" %}</span>
        {% endif %}
      </a>
    </li>
    <li>
      <a href="{% url 'notifications:list' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">
        <span>{% trans "Notifications" %}</span>
        {% if site_counters.unread_notifications %}
        <span class="inline-flex bg-blue-600 rounded text-white font-bold p-1 px-2 ml-2 justify-center text-xs">{% trans "New" %}</span>
        {% endif %}
      </a>
    </li>
    <li>
      <a href="{% url 'comments:list' %}"
         data-controller="active-link"
         data-active-link-exact
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Comments" %}</a>
    </li>
    <li>
      <a href="{% url 'activities:private' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Private Stash" %}</a>
    </li>
    <li>
      <a href="{% url 'bookmarks:activities' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Bookmarks" %}</a>
    </li>
    <li>
      <a href="{% url 'photos:gallery' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Gallery" %}</a>
    </li>
    <li>
      <a href="{% url 'events:calendar' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Calendar" %}</a>
    </li>
    <li>
      <a href="{{ user.get_absolute_url }}"
         data-controller="active-link"
         data-active-link-regex="({{ user.get_absolute_url }}|{% url 'users:comments' user.username %}|{% url 'users:messages' user.username %})$"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "My Profile" %}</a>
    </li>
    <li>
      <a href="{% url 'user_update' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Settings" %}</a>
    </li>
  </ul>

  {% if can_create_activity or can_create_message %}
  <ul class="border border-gray-500 p-3 bg-gray-100 mt-4">
    <li class="p-1 text-black font-bold border-b border-gray-500 mb-2">{% trans "Actions" %}</li>

    {% if can_create_activity %}
    <li>
      <a href="{% url 'posts:create' %}"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Submit Post" %}</a>
    </li>
    <li>
      <a href="{% url 'events:create' %}"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Submit Event" %}</a>
    </li>
    <li>
      <a href="{% url 'photos:create' %}"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Submit Photo" %}</a>
    </li>
    <li>
      <a href="{% url 'polls:create' %}"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Submit Poll" %}</a>
    </li>
    {% endif %}

    {% if can_create_message %}
    <li>
      <a href="{% url 'private_messages:message_create' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Send Message" %}</a>
    </li>
    {% endif %}
  </ul>
  {% endif %}

  <ul class="border border-gray-500 p-3 bg-gray-100 mt-4">
    <li class="p-1 text-black font-bold border-b border-gray-500 mb-2">{% trans 'Content' %}</li>
    <li>
      <a data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900"
         href="{% url 'hashtags:list' %}">
        {% trans "Tags" %}
      </a>
    </li>
    <li>
      <a data-controller="active-link"
         data-active-link-exact
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900"
         href="{% url 'activities:timeline' %}">{% trans "Timeline" %}
      </a>
    </li>
    <li>
      <a data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900"
         href="{% url 'likes:activities' %}">
        {% trans "Favorites" %}
      </a>
    </li>
    <li>
      <a data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900"
         href="{% url 'users:activity_likes' user.username %}">{% trans "Likes" %}
      </a>
    </li>
    <li>
      <a data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900"
         href="{% url 'users:activity_mentions' user.username %}">{% trans "Mentions" %}
      </a>
    </li>
    {% if can_moderate_community and site_counters.flags %}
    <li>
      <a data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900"
         href="{% url 'flags:list' %}">
        {% trans "Flags" %}
        <span class="inline-flex bg-blue-600 rounded text-white font-bold p-1 px-2 ml-2 justify-center text-xs">{% trans "New" %}</span>
      </a>
    </li>
    {% endif %}
  </ul>

  <ul class="border border-gray-500 p-3 bg-gray-100 mt-4">
    <li class="p-1 text-black font-bold border-b border-gray-500 mb-2">{% trans "People" %}</li>
    <li>
      <a href="{% url 'users:member_list' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Members" %}</a>
    </li>
    <li>
      <a href="{% url 'users:following_list' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Following" %}</a>
    </li>
    <li>
      <a href="{% url 'users:follower_list' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Followers" %}</a>
    </li>
    <li>
      <a href="{% url 'users:blocked_list' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Blocked" %}</a>
    </li>
  </ul>

  {% if can_manage_community or communities_count > 1 or community.description or community.terms %}
  <ul class="border border-gray-500 p-3 bg-gray-100 mt-4">
    <li class="p-1 text-black font-bold border-b border-gray-500 mb-2">{% trans "Community" %}</li>

    {% if community.description %}
    <li>
      <a href="{% url 'communities:community_detail' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">
        {% blocktrans with community_name=community.name %}
        About {{ community_name }}
        {% endblocktrans %}
      </a>
    </li>
    {% endif %}

    {% if community.terms %}
    <li>
      <a href="{% url 'communities:community_terms' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Terms" %}</a>
    </li>
    {% endif %}

    {% if can_manage_community %}

    <li>
      <a href="{% url 'communities:community_update' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Settings" %}</a>
    </li>

    <li>
      <a href="{% url 'communities:membership_list' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Members" %}</a>
    </li>

    <li>
      <a href="{% url 'invites:list' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">{% trans "Invites" %}</a>
    </li>

    <li>
      <a href="{% url 'join_requests:list' %}"
         data-controller="active-link"
         data-active-link-active-class="bg-gray-500 text-white"
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">
        {% trans "Join Requests" %}
        {% if site_counters.pending_join_requests %}
        <span class="inline-flex bg-blue-600 rounded text-white font-bold p-1 px-2 ml-2 justify-center text-xs">{% trans "New" %}</span>
        {% endif %}

      </a>
    </li>


    {% endif %}
    <li><a href=""
         class="block p-1 hover:bg-gray-400 hover:text-gray-900">Communities</a></li>
  </ul>
  {% endif %}

  {% else %}
  non-member menu....
  {% endif %}
</aside>
