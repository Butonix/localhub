{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% load i18n %}
{% load rules %}
{% load communities_tags %}
{% load flags_tags %}

{% has_perm "activities.create_activity" user community as can_create_activity %}
{% has_perm "communities.moderate_community" user community as can_moderate_community %}
{% has_perm "communities.manage_community" user community as can_manage_community %}
{% has_perm "private_messages.create_message" user community as can_create_message %}

{% get_available_community_count user as communities_count %}

<ul class="menu">
  <li class="menu-item">
    <a data-controller="active-link"
       data-active-link-exact
       href="{% url 'activities:home_page' %}">{% trans "Home" %}
    </a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'notifications:list' %}">
      <span {% if unread_notifications_count %}class="badge" id="sidebar-notifications-counter" data-badge="{{ unread_notifications_count }}"{% endif %}>
        {% trans "Notifications" %}
      </span>
    </a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'private_messages:inbox' %}">
      <span {% if unread_messages_count %}class="badge" id="sidebar-messages-counter" data-badge="{{ unread_messages_count }}"{% endif %}>
        {% trans "Direct Messages" %}
      </span>
    </a>
  </li>
  {% if communities_count > 1 %}
  <li class="menu-item">
    <a data-controller="active-link"
       data-active-link-exact
       href="{% url 'community_list' %}">
      {% with total_external_notifications=unread_external_notifications_count|add:unread_external_messages_count|add:pending_external_join_requests_count|add:external_drafts_count|add:external_flags_count %}
      <span {% if total_external_notifications %}class="badge" data-badge="{{ total_external_notifications }}"{% endif %}>
        {% trans "Communities" %}
      </span>
      {% endwith %}
    </a>
  </li>
  {% endif %}
</ul>

{% if can_create_activity %}
<ul class="menu mt-2">
  <li class="divider" data-content="{% trans 'Actions' %}"></li>
  {% if drafts_count %}
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'activities:drafts' %}">
      <span class="badge" data-badge="{{ drafts_count }}">{% trans "Drafts" %}</span>
    </a>
  </li>
  {% endif %}
  {% if can_create_message %}
  <li class="menu-item">
    <a data-controller="active-link" data-active-link-exact
       href="{% url 'private_messages:recipients' %}">{% trans "Send Message" %}</a>
  </li>
  {% endif %}
  {% if can_create_activity %}
  <li class="menu-item">
    <a data-controller="active-link" data-active-link-exact
       href="{% url 'posts:create' %}">{% trans "New Post" %}</a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" data-active-link-exact
       href="{% url 'events:create' %}">{% trans "New Event" %}</a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" data-active-link-exact
       href="{% url 'photos:create' %}">{% trans "New Photo" %}</a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" data-active-link-exact
       href="{% url 'polls:create' %}">{% trans "New Poll" %}</a>
  </li>
  {% endif %}
</ul>
{% endif %}

<ul class="menu mt-2">
  <li class="divider" data-content="{% trans 'People' %}"></li>
  <li class="menu-item">
    <a data-controller="active-link"
       href="{{ user.get_absolute_url }}">{% trans "My Profile" %}</a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'users:member_list' %}">
      {% trans "Members" %}
    </a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'users:following_list' %}">
      {% trans "Following" %}
    </a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'users:follower_list' %}">
      {% trans "Followers" %}
    </a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'users:blocked_list' %}">
      {% trans "Blocked" %}
    </a>
  </li>
</ul>

<ul class="menu mt-2">
  <li class="divider" data-content="{% trans 'Content' %}"></li>
  <li class="menu-item">
    <a data-controller="active-link"
       data-active-link-exact
       href="{% url 'activities:timeline' %}">{% trans "Timeline" %}
    </a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link"
       data-active-link-exact
       href="{% url 'comments:list' %}">{% trans "Comments" %}
    </a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'likes:activities' %}">
      {% trans "Likes" %}
    </a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'activities:tag_list' %}">
      {% trans "Tags" %}
    </a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'posts:list' %}">{% trans "Posts" %}</a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'events:list' %}">{% trans "Events" %}</a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'photos:list' %}">{% trans "Photos" %}</a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'polls:list' %}">{% trans "Polls" %}</a>
  </li>
  {% if flags_count %}
  <li class="menu-item">
    <a href="{% url 'flags:list' %}">
      <span class="badge" data-badge="{{ flags_count }}">
        {% trans "Flagged" %}
      </span>
    </a>
  </li>
  {% endif %}
</ul>

<ul class="menu mt-2">
  <li class="divider" data-content="{% trans 'Settings' %}"></li>
  <li class="menu-item">
    {% include "includes/mode_toggle.html" %}
  </li>
  <li class="menu-item"><a href="{% url 'user_update' %}">{% trans "My Settings" %}</a></li>
  {% if can_manage_community %}
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'communities:community_update' %}">{% trans "Community Settings" %}</a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'communities:membership_list' %}">{% trans "Memberships" %}</a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'invites:list' %}">{% trans "Invites" %}</a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'join_requests:list' %}">
      <span {% if pending_join_requests_count %}class="badge" data-badge="{{ pending_join_requests_count }}"{% endif %}>
        {% trans "Join Requests" %}
      </span>
    </a>
  </li>
  {% endif %}
</ul>

{% if community.description or community.terms %}
<ul class="menu mt-2">
  <li class="divider" data-content="{% trans 'Site Info' %}"></li>
  <li class="menu-item">
    <a data-controller="active-link"
       data-active-link-exact
       href="{% url 'communities:community_detail' %}">
      {% trans "About This Site" %}
    </a>
  </li>
  <li class="menu-item">
    <a data-controller="active-link" href="{% url 'communities:community_terms' %}">
      {% trans "Terms" %}
    </a>
  </li>
</ul>
{% endif %}
