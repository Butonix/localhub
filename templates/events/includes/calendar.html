{# Copyright (c) 2020 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% load i18n %}
<div class="border-l border-t border-gray-500 min-w-100{% if css_class %} {{ css_class }}{% endif %}">
  <div class="flex items-center justify-between bg-gray-200 px-4 py-2 border-r border-b border-gray-500">
    <a class="text-sm"
       href="{{ request.path }}?month={{ previous_month.month }}&year={{ previous_month.year }}">
      Previous
    </a>
    <div class="font-semibold">{{ current_month|date:"F Y" }}</div>
    <a class="text-sm"
       href="{{ request.path }}?month={{ next_month.month }}&year={{ next_month.year }}">
      Next
    </a>
  </div>
  <div class="flex flex-wrap justify-between text-center items-center py-4 px-1 lg:px-4 bg-gray-100 border-r border-b border-gray-500">
    <div class="text-sm calendar-item">{% trans "Mon" %}</div>
    <div class="text-sm calendar-item">{% trans "Tue" %}</div>
    <div class="text-sm calendar-item">{% trans "Wed" %}</div>
    <div class="text-sm calendar-item">{% trans "Thu" %}</div>
    <div class="text-sm calendar-item">{% trans "Fri" %}</div>
    <div class="text-sm calendar-item">{% trans "Sat" %}</div>
    <div class="text-sm calendar-item">{% trans "Sun" %}</div>
  </div>
  <div class="flex flex-wrap">
    {% for day, is_past, events in slots %}
    {% with num_events=events|length %}
    <div class="calendar-item text-xs{% if num_events %} bg-gray-100 cursor-pointer{% endif %}"
         >
      {% if day %}
      <div class="h-10 lg:h-32 p-2 tracking-tight border-r border-b border-gray-500 align-middle"
           {% if num_events %}
           data-controller="linkify"
           data-action="click->linkify#fetch"
           data-linkify-url="{{ request.path }}?day={{ day }}&month={{ current_month.month }}&year={{ current_month.year }}"
           {% endif %}>
        <button class="float-right{% if day == today.day and is_today %} font-bold text-sm{% endif %}">{{ day }}</button>
        <div class="clearfix"></div>
        {% if events %}
        <div class="hidden lg:block text-xs{% if is_past %} text-gray-500{% endif %}">
          {% for event in events|slice:":2" %}

          <a class="text-xs{% if not event.is_attendable %} line-through{% elif event.is_attending %} font-semibold{% endif %}"
             href="{{ event.get_absolute_url }}"
             title="{{ event.title }}">{{ event.title }}</a>
          {% endfor %}

          {% if num_events > 2 %}
          <a class="text-xs"
             href="#">{{ num_events|add:"-2" }} {% trans "More..." %}
          </a>
          {% endif %}

        </div>
        {% endif %}

      </div>
      {% else %}
      <div class="h-10 lg:h-32 p-2 border-b border-r border-gray-500"></div>
      {% endif %}
    </div>
    {% endwith %}
    {% endfor %}
  </div>
</div>
